<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ফরিদা ট্রান্সপোর্ট এজেন্সি</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali&display=swap"></noscript>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #2b2d42;
            --dark-gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f72585;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            position: relative;
            min-height: 100vh;
            background-color: var(--white);
        }
        
        /* Premium Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            height: 70px;
        }
        
        .header-title {
            font-size: 1.4rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .header-icons {
            display: flex;
            gap: 20px;
        }
        
        .header-icon {
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .header-icon:hover {
            transform: scale(1.1);
        }
        
        /* Premium Navigation */
        .nav-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 12px 0 10px;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
            z-index: 100;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--dark-gray);
            text-decoration: none;
            font-size: 0.75rem;
            transition: var(--transition);
            width: 25%;
        }
        
        .nav-item.active {
            color: var(--primary);
            transform: translateY(-5px);
        }
        
        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 4px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .nav-item.active .nav-icon {
            background: var(--white);
            box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
            color: var(--primary);
        }
        
        /* Premium Card Styles */
        .card {
            background-color: var(--white);
            border-radius: 16px;
            padding: 20px;
            margin: 16px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            font-size: 1.1rem;
        }
        
        /* Dashboard Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 16px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 14px;
            padding: 18px 15px;
            text-align: center;
            box-shadow: var(--shadow);
            color: white;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
        }
        
        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #11998e, #38ef7d);
        }
        
        .stat-card:nth-child(4) {
            background: linear-gradient(135deg, #f12711, #f5af19);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 8px 0;
            position: relative;
            z-index: 1;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        /* Premium Form Styles */
        .form-group {
            margin-bottom: 18px;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: var(--transition);
            background-color: var(--light);
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            background-color: var(--white);
        }
        
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Premium Button Styles */
        .btn {
            display: inline-block;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            width: 100%;
            box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.4s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.4);
        }
        
        .btn:hover::after {
            transform: translateX(100%);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #adb5bd);
            box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 6px 12px rgba(108, 117, 125, 0.4);
        }
        
        .btn-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -10%;
            width: 120%;
            height: 60%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            z-index: 0;
        }
        
        .login-card {
            background-color: var(--white);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 1;
            transform-style: preserve-3d;
            transform: perspective(1000px);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .logo i {
            font-size: 3.5rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Trip History */
        .trip-list {
            margin: 16px;
        }
        
        .trip-item {
            background-color: var(--white);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }
        
        .trip-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .trip-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .trip-vehicle {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .trip-vehicle i {
            font-size: 0.9rem;
        }
        
        .trip-date {
            color: var(--dark-gray);
            font-size: 0.8rem;
            background-color: var(--light-gray);
            padding: 4px 8px;
            border-radius: 12px;
        }
        
        .trip-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }
        
        .trip-detail {
            font-size: 0.9rem;
        }
        
        .trip-detail-label {
            color: var(--dark-gray);
            font-size: 0.8rem;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .trip-detail-label i {
            font-size: 0.7rem;
        }
        
        /* Filter Section */
        .filter-section {
            margin: 16px;
            background-color: var(--white);
            border-radius: 16px;
            padding: 18px;
            box-shadow: var(--shadow);
        }
        
        .filter-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        /* Owner Profile */
        .profile-header {
            display: flex;
            align-items: center;
            padding: 25px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .profile-header::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 18px;
            font-size: 2.2rem;
            color: var(--primary);
            border: 3px solid white;
            z-index: 1;
        }
        
        .profile-info {
            z-index: 1;
        }
        
        .profile-info h2 {
            margin-bottom: 5px;
            font-size: 1.4rem;
        }
        
        .profile-info p {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .profile-actions {
            display: flex;
            gap: 12px;
            margin: 16px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
        }
        
        .call-btn {
            background: linear-gradient(135deg, #4cc9f0, #4895ef);
        }
        
        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366, #128C7E);
        }
        
        /* Utility Classes */
        .text-center {
            text-align: center;
        }
        
        .mb-3 {
            margin-bottom: 18px;
        }
        
        .mt-3 {
            margin-top: 18px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Screen Transitions */
        .screen {
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s ease;
            padding-bottom: 80px;
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Responsive Adjustments */
@media (min-width: 768px) {
    .container {
        max-width: 450px;
        margin: 0 auto;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
        overflow-x: hidden; /* Prevent horizontal scrolling */
    }
    
    .stats-container {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
    }
    
    .stat-card {
        padding: 15px;
    }
}

/* Mobile-specific styles */
@media (max-width: 767px) {
    .container {
        width: 100%;
        padding: 0;
        margin: 0;
        overflow-x: hidden; /* Prevent horizontal scrolling */
    }
    
    .stats-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin: 10px;
    }
    
    .card {
        margin: 10px;
        padding: 15px;
    }
    
    .trip-item {
        padding: 12px;
    }
    
    .trip-details {
        grid-template-columns: 1fr;
    }
}

/* PDF Source Element (hidden from view but used for generation) */
 #pdf-source {
        font-family: 'Noto Sans Bengali', sans-serif;
        width: 100%;
        max-width: 100%;
        left: 10%;
        padding: 10px;
    }
    
.pdf-table-container {
        overflow-x: auto;
        width: 100%;
    }  

.pdf-header {
    text-align: center;
    color: #6a1b9a;
    margin-bottom: 10px;
    font-weight: 700;
}

.pdf-subheader {
    text-align: center;
    color: #555;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 14px;
}

.pdf-table {
        width: 100%;
        min-width: 600px; /* Minimum width to ensure all columns are visible */
        border-collapse: collapse;
        font-size: 10px;
        margin-right: 30px;
        margin-bottom: 20px;
    }

.pdf-table th, .pdf-table td {
        padding: 6px;
        border: 1px solid #ddd;
        text-align: center;
        white-space: nowrap;
    }

 .pdf-table th {
        background: linear-gradient(to right, #6a1b9a, #8e24aa);
        color: white;
        font-weight: 500;
    }

.pdf-table tr:nth-child(even) {
        background-color: #f9f0ff;
    }

.pdf-footer {
    text-align: center;
    font-size: 12px;
    color: #777;
    margin-top: 30px;
    padding-top: 10px;
    border-top: 1px solid #eee;
}

/* Ensure content is scrollable on mobile */
.screen {
    overflow-y: auto;
    max-height: calc(100vh - 140px); /* Account for header and nav */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="screen">
        <div class="login-container">
            <div class="login-card fade-in">
                <div class="logo">
                    <i class="fas fa-truck-moving"></i>
                </div>
                <h1 class="login-title">ফরিদা ট্রান্সপোর্ট এজেন্সি</h1>
                <div class="form-group">
                    <label for="username" class="form-label">Username/Mobile</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter username or mobile">
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter password">
                </div>
                <button id="login-btn" class="btn mt-3">
                    <span id="login-text">Login</span>
                    <span id="login-spinner" class="loading-spinner hidden"></span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main App Container (hidden initially) -->
    <div id="app-container" class="container hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-title" id="screen-title">Dashboard</div>
            <div class="header-icons">
                <i class="fas fa-bell header-icon"></i>
                <i class="fas fa-user header-icon"></i>
            </div>
        </header>
        
        <!-- Dashboard Screen -->
        <div id="dashboard-screen" class="screen">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-value" id="today-trips">0</div>
                    <div class="stat-label">Today's Trips</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pending-payment">৳0</div>
                    <div class="stat-label">Pending Payment</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-vehicles">0</div>
                    <div class="stat-label">Total Vehicles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="active-vehicles">0</div>
                    <div class="stat-label">Active Vehicles</div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-clock"></i> Recent Trip</h2>
                <div id="recent-trip">
                    <p class="text-center" style="color: var(--dark-gray);">No recent trips found</p>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> Weekly Summary</h2>
                <div id="weekly-summary" style="min-height: 150px; display: flex; align-items: center; justify-content: center;">
                    <p style="color: var(--dark-gray);">Weekly chart will be displayed here</p>
                </div>
            </div>
        </div>
        
        <!-- New Trip Screen -->
        <div id="new-trip-screen" class="screen hidden">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-plus-circle"></i> New Trip Entry</h2>
                <form id="trip-form">
                    <div class="form-group">
                        <label for="vehicle-number" class="form-label">Vehicle Number</label>
                        <select id="vehicle-number" class="form-control" required>
                            <option value="">Select Vehicle</option>
                            <option value="DHAKA-GA-11-1234">DHAKA-GA-11-1234</option>
                            <option value="DHAKA-KHA-11-5678">DHAKA-KHA-11-5678</option>
                            <option value="CHATTA-GA-11-9012">CHATTA-GA-11-9012</option>
                            <option value="CHATTA-KHA-11-3456">CHATTA-KHA-11-3456</option>
                            <option value="SYL-GA-11-7890">SYL-GA-11-7890</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="owner-name" class="form-label">Owner Name</label>
                        <input type="text" id="owner-name" class="form-control" placeholder="Enter owner name">
                    </div>
                    
                    <div class="form-group">
                        <label for="owner-mobile" class="form-label">Owner Mobile</label>
                        <input type="tel" id="owner-mobile" class="form-control" placeholder="Enter owner mobile">
                    </div>
                    
                    <div class="form-group">
                        <label for="driver-name" class="form-label">Driver Name</label>
                        <input type="text" id="driver-name" class="form-control" placeholder="Enter driver name">
                    </div>
                    
                    <div class="form-group">
                        <label for="driver-mobile" class="form-label">Driver Mobile</label>
                        <input type="tel" id="driver-mobile" class="form-control" placeholder="Enter driver mobile">
                    </div>
                    
                    <div class="form-group">
                        <label for="cargo-type" class="form-label">Cargo Type</label>
                        <select id="cargo-type" class="form-control" required>
                            <option value="">Select Cargo Type</option>
                            <option value="বস্তা">বস্তা (Sack)</option>
                            <option value="কাটন">কাটন (Carton)</option>
                            <option value="প্যাকেট">প্যাকেট (Packet)</option>
                            <option value="ড্রাম">ড্রাম (Drum)</option>
                            <option value="সিমেন্ট">সিমেন্ট (Cement)</option>
                            <option value="চাল">চাল (Rice)</option>
                            <option value="গম">গম (Wheat)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="cargo-weight" class="form-label">Cargo Weight (Ton)</label>
                        <input type="number" id="cargo-weight" class="form-control" placeholder="Enter weight in ton" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="transport-owner" class="form-label">Transport Owner</label>
                        <input type="text" id="transport-owner" class="form-control" placeholder="Enter Transport Owner">
                    </div>
                    
                    <!-- Chittagong Loading Points -->
                    <div class="form-group">
                        <label for="loading-point" class="form-label">Loading Point (Chittagong)</label>
                        <select id="loading-point" class="form-control" required>
                            <option value="">Select Loading Point</option>
                            <optgroup label="Container Depots">
                                <option value="এসসাক ব্রাদার্স, হালিশহর">১. এসসাক ব্রাদার্স (হালিশহর, বন্দর এলাকা)</option>
                                <option value="চট্টগ্রাম কনটেইনার ট্রান্সপোর্ট, বন্দর স্টেডিয়াম">২. চট্টগ্রাম কনটেইনার ট্রান্সপোর্ট (বন্দর স্টেডিয়াম এরিয়া)</option>
                                <option value="কেএন্ডটি লজিস্টিকস, চট্টগ্রাম ইপিজেড">৩. কেএন্ডটি লজিস্টিকস (চট্টগ্রাম ইপিজেড)</option>
                                <option value="কিউএনএস কনটেইনার সার্ভিস, সিইপিজেড">৪. কিউএনএস কনটেইনার সার্ভিস (সিইপিজেড, সেক্টর-৬)</option>
                                <option value="সামিট অ্যালায়েন্স, কাঠগড়">৫. সামিট অ্যালায়েন্স (কাঠগড়, উত্তর পতেঙ্গা)</option>
                                <option value="ভার্টেক্স লজিস্টিকস, কাঠগড়">৬. ভার্টেক্স লজিস্টিকস (কাঠগড়, পতেঙ্গা)</option>
                                <option value="গোল্ডেন কনটেইনারস, পাহাড়তলী">১১. গোল্ডেন কনটেইনারস (পাহাড়তলী, সিটি গেইট)</option>
                                <option value="বিএম কনটেইনার ডিপো, কেশলপুর">১২. বিএম কনটেইনার ডিপো (কেশলপুর, সীতাকুণ্ড)</option>
                            </optgroup>
                            <optgroup label="Other Locations">
                                <option value="শফি মোটরস, সাগরিকা">৭. শফি মোটরস (সাগরিকা, ফৌজদারহাট)</option>
                                <option value="পোর্টলিংক লজিস্টিক, ভাটিয়ারি">৮. পোর্টলিংক লজিস্টিক (ভাটিয়ারি, চট্টগ্রাম)</option>
                                <option value="কেডিএস লজিস্টিকস, সীতাকুণ্ড">৯. কেডিএস লজিস্টিকস (সীতাকুণ্ড, সোনাইছড়ি)</option>
                                <option value="ইনকন্ট্রেড লিমিটেড, পূর্ব পতেঙ্গা">১০. ইনকন্ট্রেড লিমিটেড (পূর্ব পতেঙ্গা)</option>
                                <option value="ইস্টার্ন লজিস্টিকস, পতেঙ্গা">১৩. ইস্টার্ন লজিস্টিকস (পতেঙ্গা)</option>
                                <option value="হাজী সাবের আহমদ টিম্বার, কালুরঘাট">১৪. হাজী সাবের আহমদ টিম্বার (কালুরঘাট ইন্ডাস্ট্রিয়াল এরিয়া)</option>
                                <option value="নেমসান কনটেইনার, কুমিরা">১৫. নেমসান কনটেইনার (কুমিরা, সীতাকুণ্ড)</option>
                            </optgroup>
                            <optgroup label="Government Depots">
                                <option value="বিআরটিসি বাস ডিপো, বহদ্দারহাট">বিআরটিসি বাস ডিপো (বহদ্দারহাট/আকবরশাহ্)</option>
                                <option value="বিআরটিসি ট্রাক ডিপো, পাহাড়তলী">বিআরটিসি ট্রাক ডিপো (পাহাড়তলী শিল্প এলাকা)</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <!-- Dhaka Division Unloading Points -->
                    <div class="form-group">
                        <label for="unloading-point" class="form-label">Unloading Point (Dhaka Division)</label>
                        <select id="unloading-point" class="form-control" required>
                            <option value="">Select Unloading Point</option>
                            <option value="ঢাকা">ঢাকা</option>
                            <option value="গাজীপুর">গাজীপুর</option>
                            <option value="নারায়ণগঞ্জ">নারায়ণগঞ্জ</option>
                            <option value="নরসিংদী">নরসিংদী</option>
                            <option value="মানিকগঞ্জ">মানিকগঞ্জ</option>
                            <option value="মুন্সিগঞ্জ">মুন্সিগঞ্জ</option>
                            <option value="টাঙ্গাইল">টাঙ্গাইল</option>
                            <option value="কিশোরগঞ্জ">কিশোরগঞ্জ</option>
                            <option value="ফরিদপুর">ফরিদপুর</option>
                            <option value="মাদারীপুর">মাদারীপুর</option>
                            <option value="গোপালগঞ্জ">গোপালগঞ্জ</option>
                            <option value="রাজবাড়ী">রাজবাড়ী</option>
                            <option value="শরীয়তপুর">শরীয়তপুর</option>
                            <!-- Sub-locations under Dhaka Division -->
                            <option value="বিমানবন্দর (হাজী ক্যাম্প)">বিমানবন্দর (হাজী ক্যাম্প)</option>
                            <option value="আজমপুর">আজমপুর</option>
                            <option value="আবদুল্লাহপুর">আবদুল্লাহপুর</option>
                            <option value="আশুলিয়া">আশুলিয়া</option>
                            <option value="জিরানী বাজার">জিরানী বাজার</option>
                            <option value="বাইপাইল – টঙ্গী রোড">বাইপাইল – টঙ্গী রোড</option>
                            <option value="নবীনগর – চন্দ্রা রোড">নবীনগর – চন্দ্রা রোড</option>
                            <option value="টঙ্গী – গাজীপুর রোড">টঙ্গী – গাজীপুর রোড</option>
                            <option value="সাভার ইপিজেড">সাভার ইপিজেড</option>
                            <option value="বাড়ইপাড়া">বাড়ইপাড়া</option>
                            <option value="নিশচিন্তপুর">নিশচিন্তপুর</option>
                            <option value="নয়ারহাট">নয়ারহাট</option>
                            <option value="হেমায়েতপুর">হেমায়েতপুর</option>
                            <option value="কাঠপট্টি, ভাকুর্তা">কাঠপট্টি, ভাকুর্তা</option>
                            <option value="আলিয়ারপুর">আলিয়ারপুর</option>
                            <option value="কেরানীগঞ্জ">কেরানীগঞ্জ</option>
                            <option value="জিনজিরা">জিনজিরা</option>
                            <option value="ডেমরা">ডেমরা</option>
                            <option value="শ্যামপুর">শ্যামপুর</option>
                            <option value="নতুন পল্টন/মগবাজার">নতুন পল্টন/মগবাজার</option>
                            <option value="সাইনবোর্ড (নারায়ণগঞ্জ বাইপাস পয়েন্ট)">সাইনবোর্ড (নারায়ণগঞ্জ বাইপাস পয়েন্ট)</option>
                            <option value="মাতুয়াইল – ডেমরা রোড">মাতুয়াইল – ডেমরা রোড</option>
                            <option value="যাত্রাবাড়ী">যাত্রাবাড়ী</option>
                            <option value="গুলজারবাগ">গুলজারবাগ</option>
                            <option value="কাঁচপুর">কাঁচপুর</option>
                            <option value="পোস্টোগোলা">পোস্টোগোলা</option>
                            <option value="বাবুবাজার">বাবুবাজার</option>
                            <option value="গাবতলী">গাবতলী</option>
                            <option value="আমুলিয়া">আমুলিয়া</option>
                            <option value="রুপগঞ্জ">রুপগঞ্জ</option>
                            <option value="আমিনবাজার">আমিনবাজার</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="total-fare" class="form-label">Total Fare (৳)</label>
                        <input type="number" id="total-fare" class="form-control" placeholder="Enter total fare" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="advance-payment" class="form-label">Advance Payment (৳)</label>
                        <input type="number" id="advance-payment" class="form-control" placeholder="Enter advance payment" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="due-payment" class="form-label">Due Payment (৳)</label>
                        <input type="number" id="due-payment" class="form-control" placeholder="Due amount" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="commission" class="form-label">Transport Commission (৳)</label>
                        <input type="number" id="commission" class="form-control" placeholder="Enter commission amount" min="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="trip-notes" class="form-label">Trip Notes (Optional)</label>
                        <textarea id="trip-notes" class="form-control" rows="3" placeholder="Any additional notes"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-icon">
                        <i class="fas fa-save"></i> Save Trip
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Trip History Screen -->
        <div id="trip-history-screen" class="screen hidden">
            <div class="filter-section">
                <div class="filter-title">
                    <h3 class="card-title"><i class="fas fa-filter"></i> Filter Trips</h3>
                    <i class="fas fa-sliders-h"></i>
                </div>
                <div class="form-group">
                    <label for="filter-date" class="form-label">Date Range</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="date" id="filter-date-from" class="form-control" style="flex: 1;">
                        <input type="date" id="filter-date-to" class="form-control" style="flex: 1;">
                    </div>
                </div>
                <div class="form-group">
                    <label for="filter-vehicle" class="form-label">Vehicle</label>
                    <select id="filter-vehicle" class="form-control">
                        <option value="">All Vehicles</option>
                        <option value="DHAKA-GA-11-1234">DHAKA-GA-11-1234</option>
                        <option value="DHAKA-KHA-11-5678">DHAKA-KHA-11-5678</option>
                        <option value="CHATTA-GA-11-9012">CHATTA-GA-11-9012</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filter-owner" class="form-label">Owner</label>
                    <select id="filter-owner" class="form-control">
                        <option value="">All Owners</option>
                        <option value="Abdul Karim">Abdul Karim</option>
                        <option value="Rahim Uddin">Rahim Uddin</option>
                        <option value="Mohammad Ali">Mohammad Ali</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filter-status" class="form-label">Payment Status</label>
                    <select id="filter-status" class="form-control">
                        <option value="">All Statuses</option>
                        <option value="paid">Paid</option>
                        <option value="due">Due</option>
                    </select>
                </div>
                <button id="apply-filter" class="btn btn-secondary btn-icon">
                    <i class="fas fa-check"></i> Apply Filter
                </button>
                <button id="reset-filter" class="btn btn-secondary btn-icon mt-3">
                    <i class="fas fa-undo"></i> Reset Filter
                </button>
            </div>
            
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 class="card-title"><i class="fas fa-list"></i> Trip Records</h3>
                    <span id="trip-count" style="font-size: 0.8rem; color: var(--dark-gray);">0 trips found</span>
                </div>
                <div class="trip-list" id="trip-list">
                    <!-- Trip items will be added here dynamically -->
                </div>
            </div>
            
            <div class="card">
                <button id="export-pdf" class="btn btn-secondary btn-icon mb-3">
                    <i class="fas fa-file-pdf"></i> Export as PDF
                </button>
                <button id="export-excel" class="btn btn-secondary btn-icon">
                    <i class="fas fa-file-excel"></i> Export as Excel
                </button>
            </div>
        </div>
        
        <!-- Owner Profile Screen -->
        <div id="owner-profile-screen" class="screen hidden">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="profile-info">
                    <h2 id="profile-name">Loading...</h2>
                    <p id="profile-mobile">Loading...</p>
                </div>
            </div>
            
            <div class="profile-actions">
                <a href="#" id="call-btn" class="action-btn call-btn">
                    <i class="fas fa-phone"></i> Call
                </a>
                <a href="#" id="whatsapp-btn" class="action-btn whatsapp-btn">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-truck"></i> Owned Vehicles</h2>
                <div class="vehicle-list" id="vehicle-list">
                    <!-- Vehicles will be added here dynamically -->
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-pie"></i> Financial Summary</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div style="background-color: var(--light); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--dark-gray);">Total Trips</div>
                        <div style="font-size: 1.4rem; font-weight: 600; color: var(--primary);" id="owner-total-trips">0</div>
                    </div>
                    <div style="background-color: var(--light); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--dark-gray);">Total Earnings</div>
                        <div style="font-size: 1.4rem; font-weight: 600; color: var(--success);" id="owner-total-earnings">৳0</div>
                    </div>
                    <div style="background-color: var(--light); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--dark-gray);">Due Amount</div>
                        <div style="font-size: 1.4rem; font-weight: 600; color: var(--danger);" id="owner-due-amount">৳0</div>
                    </div>
                    <div style="background-color: var(--light); padding: 12px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--dark-gray);">Commission</div>
                        <div style="font-size: 1.4rem; font-weight: 600; color: var(--warning);" id="owner-commission">৳0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <nav class="nav-bottom">
            <a href="#" class="nav-item active" data-screen="dashboard">
                <i class="fas fa-home nav-icon"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-screen="new-trip">
                <i class="fas fa-plus-circle nav-icon"></i>
                <span>New Trip</span>
            </a>
            <a href="#" class="nav-item" data-screen="trip-history">
                <i class="fas fa-history nav-icon"></i>
                <span>History</span>
            </a>
            <a href="#" class="nav-item" data-screen="owner-profile">
                <i class="fas fa-user-tie nav-icon"></i>
                <span>Owners</span>
            </a>
        </nav>
    </div>
<div id="pdf-source">
    <h1 class="pdf-header">ফরিদা ট্রান্সপোর্ট এজেন্সি</h1>
    <p class="pdf-subheader">তারিখ: <span id="pdf-date"></span></p>
    <div class="pdf-table-container">
        <table class="pdf-table">
            <thead>
                <tr>
                    <th>ক্রমিক</th>
                    <th>গাড়ি নং</th>
                    <th>মালিক</th>
                    <th>মালের ধরন</th>
                    <th>ওজন (টন)</th>
                    <th>লোডিং পয়েন্ট</th>
                    <th>আনলোডিং পয়েন্ট</th>
                    <th>মোট ভাড়া</th>
                    <th>অগ্রিম</th>
                    <th>বাকি</th>
                    <th>কমিশন</th>
                </tr>
            </thead>
            <tbody id="pdf-table-body">
                <!-- Data will be inserted here -->
            </tbody>
        </table>
    </div>
    <div class="pdf-footer">
        <p>ফোন: ০১৭১২-৩৪৫৬৭৮ | ইমেইল: faridatransport@gmail.com</p>
        <p>© ফরিদা ট্রান্সপোর্ট এজেন্সি। সর্বস্বত্ব সংরক্ষিত।</p>
    </div>
</div>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Database keys
        const DB_KEYS = {
            TRIPS: 'farida_transport_trips',
            OWNERS: 'farida_transport_owners',
            VEHICLES: 'farida_transport_vehicles',
            USER: 'farida_transport_user'
        };
        
        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const appContainer = document.getElementById('app-container');
        const loginBtn = document.getElementById('login-btn');
        const loginText = document.getElementById('login-text');
        const loginSpinner = document.getElementById('login-spinner');
        const toast = document.getElementById('toast');
        
        // Screens
        const screens = {
            dashboard: document.getElementById('dashboard-screen'),
            'new-trip': document.getElementById('new-trip-screen'),
            'trip-history': document.getElementById('trip-history-screen'),
            'owner-profile': document.getElementById('owner-profile-screen')
        };
        
        // Navigation items
        const navItems = document.querySelectorAll('.nav-item');
        const screenTitle = document.getElementById('screen-title');
        
        // Form elements
        const tripForm = document.getElementById('trip-form');
        const totalFare = document.getElementById('total-fare');
        const advancePayment = document.getElementById('advance-payment');
        const duePayment = document.getElementById('due-payment');
        
        // Dashboard stats
        const todayTrips = document.getElementById('today-trips');
        const pendingPayment = document.getElementById('pending-payment');
        const totalVehicles = document.getElementById('total-vehicles');
        const activeVehicles = document.getElementById('active-vehicles');
        
        // Trip history elements
        const tripList = document.getElementById('trip-list');
        const tripCount = document.getElementById('trip-count');
        
        // Owner profile elements
        const vehicleList = document.getElementById('vehicle-list');
        const profileName = document.getElementById('profile-name');
        const profileMobile = document.getElementById('profile-mobile');
        const callBtn = document.getElementById('call-btn');
        const whatsappBtn = document.getElementById('whatsapp-btn');
        const ownerTotalTrips = document.getElementById('owner-total-trips');
        const ownerTotalEarnings = document.getElementById('owner-total-earnings');
        const ownerDueAmount = document.getElementById('owner-due-amount');
        const ownerCommission = document.getElementById('owner-commission');
        
        // Initialize database
        function initDatabase() {
            // Check if trips exist in local storage
            if (!localStorage.getItem(DB_KEYS.TRIPS)) {
                localStorage.setItem(DB_KEYS.TRIPS, JSON.stringify([]));
            }
            
            // Check if owners exist in local storage
            if (!localStorage.getItem(DB_KEYS.OWNERS)) {
                const defaultOwners = [
                    {
                        id: 1,
                        name: 'Abdul Karim',
                        mobile: '+8801712345678',
                        vehicles: [
                            {
                                number: 'DHAKA-GA-11-1234',
                                driver: 'Jamal Uddin',
                                status: 'Active',
                                lastTrip: null
                            },
                            {
                                number: 'DHAKA-CHA-11-2468',
                                driver: 'Kamal Hossain',
                                status: 'Inactive',
                                lastTrip: null
                            }
                        ],
                        totalTrips: 0,
                        totalEarnings: 0,
                        dueAmount: 0,
                        totalCommission: 0
                    },
                    {
                        id: 2,
                        name: 'Rahim Uddin',
                        mobile: '+8801712345679',
                        vehicles: [
                            {
                                number: 'DHAKA-KHA-11-5678',
                                driver: 'Kamal Hossain',
                                status: 'Active',
                                lastTrip: null
                            }
                        ],
                        totalTrips: 0,
                        totalEarnings: 0,
                        dueAmount: 0,
                        totalCommission: 0
                    },
                    {
                        id: 3,
                        name: 'Mohammad Ali',
                        mobile: '+8801712345680',
                        vehicles: [
                            {
                                number: 'CHATTA-GA-11-9012',
                                driver: 'Rafiq Islam',
                                status: 'Active',
                                lastTrip: null
                            },
                            {
                                number: 'CHATTA-KHA-11-3456',
                                driver: 'Salam Miah',
                                status: 'Inactive',
                                lastTrip: null
                            }
                        ],
                        totalTrips: 0,
                        totalEarnings: 0,
                        dueAmount: 0,
                        totalCommission: 0
                    }
                ];
                localStorage.setItem(DB_KEYS.OWNERS, JSON.stringify(defaultOwners));
            }
            
            // Check if vehicles exist in local storage
            if (!localStorage.getItem(DB_KEYS.VEHICLES)) {
                const defaultVehicles = [
                    { number: 'DHAKA-GA-11-1234', ownerId: 1, status: 'Active' },
                    { number: 'DHAKA-CHA-11-2468', ownerId: 1, status: 'Inactive' },
                    { number: 'DHAKA-KHA-11-5678', ownerId: 2, status: 'Active' },
                    { number: 'CHATTA-GA-11-9012', ownerId: 3, status: 'Active' },
                    { number: 'CHATTA-KHA-11-3456', ownerId: 3, status: 'Inactive' },
                    { number: 'SYL-GA-11-7890', ownerId: 3, status: 'Active' }
                ];
                localStorage.setItem(DB_KEYS.VEHICLES, JSON.stringify(defaultVehicles));
            }
        }
        
        // Get trips from local storage
        function getTrips() {
            return JSON.parse(localStorage.getItem(DB_KEYS.TRIPS)) || [];
        }
        
        // Save trips to local storage
        function saveTrips(trips) {
            localStorage.setItem(DB_KEYS.TRIPS, JSON.stringify(trips));
        }
        
        // Get owners from local storage
        function getOwners() {
            return JSON.parse(localStorage.getItem(DB_KEYS.OWNERS)) || [];
        }
        
        // Save owners to local storage
        function saveOwners(owners) {
            localStorage.setItem(DB_KEYS.OWNERS, JSON.stringify(owners));
        }
        
        // Get vehicles from local storage
        function getVehicles() {
            return JSON.parse(localStorage.getItem(DB_KEYS.VEHICLES)) || [];
        }
        
        // Save vehicles to local storage
        function saveVehicles(vehicles) {
            localStorage.setItem(DB_KEYS.VEHICLES, JSON.stringify(vehicles));
        }
        
        // Get owner by vehicle number
        function getOwnerByVehicle(vehicleNumber) {
            const vehicles = getVehicles();
            const owners = getOwners();
            
            const vehicle = vehicles.find(v => v.number === vehicleNumber);
            if (!vehicle) return null;
            
            return owners.find(o => o.id === vehicle.ownerId);
        }
        
        // Update owner statistics
        function updateOwnerStatistics(ownerId) {
            const trips = getTrips();
            const owners = getOwners();
            
            const owner = owners.find(o => o.id === ownerId);
            if (!owner) return;
            
            const ownerTrips = trips.filter(trip => {
                const vehicleOwner = getOwnerByVehicle(trip.vehicleNumber);
                return vehicleOwner && vehicleOwner.id === ownerId;
            });
            
            owner.totalTrips = ownerTrips.length;
            owner.totalEarnings = ownerTrips.reduce((sum, trip) => sum + trip.totalFare, 0);
            owner.dueAmount = ownerTrips.reduce((sum, trip) => sum + trip.duePayment, 0);
            owner.totalCommission = ownerTrips.reduce((sum, trip) => sum + trip.commission, 0);
            
            // Update last trip for each vehicle
            owner.vehicles.forEach(vehicle => {
                const vehicleTrips = trips.filter(t => t.vehicleNumber === vehicle.number);
                if (vehicleTrips.length > 0) {
                    const lastTrip = vehicleTrips.reduce((latest, trip) => {
                        return new Date(trip.date) > new Date(latest.date) ? trip : latest;
                    }, vehicleTrips[0]);
                    
                    vehicle.lastTrip = formatDate(lastTrip.date, true);
                    vehicle.status = 'Active';
                } else {
                    vehicle.status = 'Inactive';
                }
            });
            
            saveOwners(owners);
        }
        
        // Show toast notification
        function showToast(message, duration = 3000) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // Login functionality
        loginBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple validation
            if (username && password) {
                // Show loading state
                loginText.classList.add('hidden');
                loginSpinner.classList.remove('hidden');
                
                // Simulate login process
                setTimeout(() => {
                    // Initialize database
                    initDatabase();
                    
                    // Save user to local storage
                    localStorage.setItem(DB_KEYS.USER, JSON.stringify({
                        username,
                        loggedIn: true,
                        lastLogin: new Date()
                    }));
                    
                    // Hide login screen, show app
                    loginScreen.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                    
                    // Reset login form
                    loginText.classList.remove('hidden');
                    loginSpinner.classList.add('hidden');
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    // Initialize screens
                    updateDashboard();
                    renderTripHistory();
                    renderOwnerProfile();
                    
                    showToast('Login successful! Welcome back.');
                }, 1500);
            } else {
                showToast('Please enter both username and password');
            }
        });
        
        // Navigation functionality
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const screenName = this.getAttribute('data-screen');
                
                // Update active nav item
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                
                // Hide all screens
                Object.values(screens).forEach(screen => screen.classList.add('hidden'));
                
                // Show selected screen
                screens[screenName].classList.remove('hidden');
                
                // Update screen title
                switch(screenName) {
                    case 'dashboard':
                        screenTitle.textContent = 'Dashboard';
                        updateDashboard();
                        break;
                    case 'new-trip':
                        screenTitle.textContent = 'New Trip';
                        break;
                    case 'trip-history':
                        screenTitle.textContent = 'Trip History';
                        renderTripHistory();
                        break;
                    case 'owner-profile':
                        screenTitle.textContent = 'Owner Profile';
                        renderOwnerProfile();
                        break;
                }
            });
        });
        
        // Calculate due payment automatically
        totalFare.addEventListener('input', calculateDuePayment);
        advancePayment.addEventListener('input', calculateDuePayment);
        
        function calculateDuePayment() {
            const fare = parseFloat(totalFare.value) || 0;
            const advance = parseFloat(advancePayment.value) || 0;
            duePayment.value = (fare - advance).toFixed(2);
        }
        
        // Form submission
        tripForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Create new trip object
            const newTrip = {
                id: Date.now(), // Use timestamp as unique ID
                vehicleNumber: document.getElementById('vehicle-number').value,
                ownerName: document.getElementById('owner-name').value,
                ownerMobile: document.getElementById('owner-mobile').value,
                driverName: document.getElementById('driver-name').value,
                driverMobile: document.getElementById('driver-mobile').value,
                cargoType: document.getElementById('cargo-type').value,
                cargoWeight: parseFloat(document.getElementById('cargo-weight').value),
                transportOwner: document.getElementById('transport-owner').value,
                loadingPoint: document.getElementById('loading-point').value,
                unloadingPoint: document.getElementById('unloading-point').value,
                totalFare: parseFloat(document.getElementById('total-fare').value),
                advancePayment: parseFloat(document.getElementById('advance-payment').value),
                duePayment: parseFloat(document.getElementById('due-payment').value),
                commission: parseFloat(document.getElementById('commission').value) || 0,
                date: new Date().toISOString(),
                notes: document.getElementById('trip-notes').value
            };
            
            // Get current trips and add new trip
            const trips = getTrips();
            trips.unshift(newTrip);
            saveTrips(trips);
            
            // Update owner statistics
            const owner = getOwnerByVehicle(newTrip.vehicleNumber);
            if (owner) {
                updateOwnerStatistics(owner.id);
            }
            
            // Update vehicle status
            const vehicles = getVehicles();
            const vehicleIndex = vehicles.findIndex(v => v.number === newTrip.vehicleNumber);
            if (vehicleIndex !== -1) {
                vehicles[vehicleIndex].status = 'Active';
                saveVehicles(vehicles);
            }
            
            // Reset form
            this.reset();
            
            // Show success message
            showToast('Trip saved successfully!');
            
            // Go back to dashboard
            navItems[0].click();
            
            // Update dashboard and history
            updateDashboard();
        });
        
        // Update dashboard with latest data
        function updateDashboard() {
            const trips = getTrips();
            const owners = getOwners();
            const vehicles = getVehicles();
            
            // Count today's trips
            const today = new Date().toDateString();
            const todaysTrips = trips.filter(trip => 
                new Date(trip.date).toDateString() === today
            );
            todayTrips.textContent = todaysTrips.length;
            
            // Calculate pending payment
            const totalPending = trips.reduce((sum, trip) => sum + trip.duePayment, 0);
            pendingPayment.textContent = `৳${totalPending.toLocaleString('en-IN')}`;
            
            // Vehicle counts
            totalVehicles.textContent = vehicles.length;
            const activeCount = vehicles.filter(v => v.status === 'Active').length;
            activeVehicles.textContent = activeCount;
            
            // Show most recent trip
            const recentTripContainer = document.getElementById('recent-trip');
            if (trips.length > 0) {
                const trip = trips[0];
                recentTripContainer.innerHTML = `
                    <div class="trip-item">
                        <div class="trip-header">
                            <span class="trip-vehicle"><i class="fas fa-truck"></i> ${trip.vehicleNumber}</span>
                            <span class="trip-date">${formatTime(trip.date)}</span>
                        </div>
                        <div class="trip-details">
                            <div class="trip-detail">
                                <div class="trip-detail-label"><i class="fas fa-map-marker-alt"></i> Route</div>
                                <div>${trip.loadingPoint.split(',')[0]} → ${trip.unloadingPoint}</div>
                            </div>
                            <div class="trip-detail">
                                <div class="trip-detail-label"><i class="fas fa-box"></i> Cargo</div>
                                <div>${trip.cargoType} (${trip.cargoWeight} Ton)</div>
                            </div>
                            <div class="trip-detail">
                                <div class="trip-detail-label"><i class="fas fa-money-bill-wave"></i> Fare</div>
                                <div>৳${trip.totalFare.toLocaleString('en-IN')} ${trip.duePayment > 0 ? `(৳${trip.duePayment.toLocaleString('en-IN')} Due)` : '(Paid)'}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                recentTripContainer.innerHTML = '<p class="text-center" style="color: var(--dark-gray);">No recent trips found</p>';
            }
        }
        
        // Render trip history with filters
        function renderTripHistory() {
            tripList.innerHTML = '';
            
            let trips = getTrips();
            
            // Apply filters
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            const vehicleFilter = document.getElementById('filter-vehicle').value;
            const ownerFilter = document.getElementById('filter-owner').value;
            const statusFilter = document.getElementById('filter-status').value;
            
            if (dateFrom) {
                trips = trips.filter(trip => new Date(trip.date) >= new Date(dateFrom));
            }
            
            if (dateTo) {
                const toDate = new Date(dateTo);
                toDate.setDate(toDate.getDate() + 1); // Include the entire end date
                trips = trips.filter(trip => new Date(trip.date) <= toDate);
            }
            
            if (vehicleFilter) {
                trips = trips.filter(trip => trip.vehicleNumber === vehicleFilter);
            }
            
            if (ownerFilter) {
                trips = trips.filter(trip => trip.ownerName === ownerFilter);
            }
            
            if (statusFilter === 'paid') {
                trips = trips.filter(trip => trip.duePayment <= 0);
            } else if (statusFilter === 'due') {
                trips = trips.filter(trip => trip.duePayment > 0);
            }
            
            if (trips.length === 0) {
                tripList.innerHTML = '<p class="text-center" style="color: var(--dark-gray);">No trips found</p>';
                tripCount.textContent = '0 trips found';
                return;
            }
            
            trips.forEach(trip => {
                const tripItem = document.createElement('div');
                tripItem.className = 'trip-item';
                tripItem.innerHTML = `
                    <div class="trip-header">
                        <span class="trip-vehicle"><i class="fas fa-truck"></i> ${trip.vehicleNumber}</span>
                        <span class="trip-date">${formatDate(trip.date)}</span>
                    </div>
                    <div class="trip-details">
                        <div class="trip-detail">
                            <div class="trip-detail-label"><i class="fas fa-user-tie"></i> Owner</div>
                            <div>${trip.ownerName}</div>
                        </div>
                        <div class="trip-detail">
                            <div class="trip-detail-label"><i class="fas fa-box"></i> Cargo</div>
                            <div>${trip.cargoType} (${trip.cargoWeight} Ton)</div>
                        </div>
                        <div class="trip-detail">
                            <div class="trip-detail-label"><i class="fas fa-route"></i> Route</div>
                            <div>${trip.loadingPoint.split(',')[0]} → ${trip.unloadingPoint}</div>
                        </div>
                        <div class="trip-detail">
                            <div class="trip-detail-label"><i class="fas fa-money-bill-wave"></i> Fare</div>
                            <div>৳${trip.totalFare.toLocaleString('en-IN')} ${trip.duePayment > 0 ? `(৳${trip.duePayment.toLocaleString('en-IN')} Due)` : '(Paid)'}</div>
                        </div>
                    </div>
                `;
                tripList.appendChild(tripItem);
            });
            
            tripCount.textContent = `${trips.length} ${trips.length === 1 ? 'trip' : 'trips'} found`;
        }
        
        // Render owner profile
        function renderOwnerProfile() {
            vehicleList.innerHTML = '';
            
            const owners = getOwners();
            
            if (owners.length === 0) {
                vehicleList.innerHTML = '<p class="text-center" style="color: var(--dark-gray);">No owners found</p>';
                return;
            }
            
            // For demo, show first owner
            const owner = owners[0];
            
            // Update profile header
            profileName.textContent = owner.name;
            profileMobile.textContent = owner.mobile;
            
            // Update contact buttons
            callBtn.href = `tel:${owner.mobile}`;
            whatsappBtn.href = `https://wa.me/${owner.mobile.replace('+', '')}`;
            
            // Update financial summary
            ownerTotalTrips.textContent = owner.totalTrips;
            ownerTotalEarnings.textContent = `৳${owner.totalEarnings.toLocaleString('en-IN')}`;
            ownerDueAmount.textContent = `৳${owner.dueAmount.toLocaleString('en-IN')}`;
            ownerCommission.textContent = `৳${owner.totalCommission.toLocaleString('en-IN')}`;
            
            // Render vehicles
            owner.vehicles.forEach(vehicle => {
                const vehicleItem = document.createElement('div');
                vehicleItem.className = 'trip-item';
                vehicleItem.innerHTML = `
                    <div class="trip-header">
                        <span class="trip-vehicle"><i class="fas fa-truck"></i> ${vehicle.number}</span>
                        <span class="trip-date">${vehicle.status}</span>
                    </div>
                    <div class="trip-details">
                        <div class="trip-detail">
                            <div class="trip-detail-label"><i class="fas fa-user"></i> Driver</div>
                            <div>${vehicle.driver}</div>
                        </div>
                        <div class="trip-detail">
                            <div class="trip-detail-label"><i class="fas fa-clock"></i> Last Trip</div>
                            <div>${vehicle.lastTrip || 'No trips yet'}</div>
                        </div>
                    </div>
                `;
                vehicleList.appendChild(vehicleItem);
            });
        }
        
        // Helper function to format date
        function formatDate(dateString, includeTime = false) {
            const date = new Date(dateString);
            const options = { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            };
            
            if (includeTime) {
                const today = new Date().toDateString();
                const dateStr = date.toDateString();
                
                if (today === dateStr) {
                    return `Today, ${formatTime(dateString)}`;
                } else {
                    return date.toLocaleDateString('en-US', options);
                }
            }
            
            return date.toLocaleDateString('en-US', options);
        }
        
        // Helper function to format time
        function formatTime(dateString) {
            const date = new Date(dateString);
            const options = { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            };
            return date.toLocaleTimeString('en-US', options);
        }
        
        // Fixed PDF export function
async function exportToPDF() {
    try {
        // Show loading state
        showToast('PDF তৈরি করা হচ্ছে...', 3000);
        
        // Get trips data
        const trips = getTrips();
        
        // Format current date in Bengali
        const today = new Date();
        const dateOptions = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        document.getElementById('pdf-date').textContent = today.toLocaleDateString('bn-BD', dateOptions);
        
        // Populate table body
        const tbody = document.getElementById('pdf-table-body');
        tbody.innerHTML = '';
        
        trips.forEach((trip, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${trip.vehicleNumber}</td>
                <td>${trip.ownerName}</td>
                <td>${trip.cargoType}</td>
                <td>${trip.cargoWeight}</td>
                <td>${trip.loadingPoint.split(',')[0]}</td>
                <td>${trip.unloadingPoint}</td>
                <td>৳${trip.totalFare.toLocaleString('bn-BD')}</td>
                <td>৳${trip.advancePayment.toLocaleString('bn-BD')}</td>
                <td>৳${trip.duePayment.toLocaleString('bn-BD')}</td>
                <td>৳${trip.commission.toLocaleString('bn-BD')}</td>
            `;
            tbody.appendChild(row);
        });
        
        // Temporarily show the PDF source element
        const pdfSource = document.getElementById('pdf-source');
        const originalStyles = {
            position: pdfSource.style.position,
            left: pdfSource.style.left,
            width: pdfSource.style.width,
            padding: pdfSource.style.padding
        };
        
        pdfSource.style.position = 'relative';
        pdfSource.style.left = '0';
        pdfSource.style.width = '100vh';
        pdfSource.style.padding = '15mm';
        
        // PDF options
        const options = {
            margin: -8,
            filename: `Farida_Transport_${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}.pdf`,
            image: { 
                type: 'jpeg', 
                quality: 0.98 
            },
            html2canvas: { 
                scale: 2,
                letterRendering: true,
                useCORS: true,
                allowTaint: false,
                logging: true,
                scrollX: 0,
                scrollY: 0
            },
            jsPDF: { 
                unit: 'mm',
                format: 'a4',
                orientation: 'portrait'
            }
        };
        
        // Create and download PDF
        await html2pdf()
            .set(options)
            .from(pdfSource)
            .save()
            .then(() => {
                showToast('PDF ডাউনলোড সম্পন্ন হয়েছে', 3000);
            });
        
    } catch (error) {
        console.error('PDF generation error:', error);
        showToast('PDF তৈরি করতে সমস্যা হয়েছে: ' + error.message, 5000);
    } finally {
        // Reset styles
        const pdfSource = document.getElementById('pdf-source');
        pdfSource.style.position = originalStyles.position;
        pdfSource.style.left = originalStyles.left;
        pdfSource.style.width = originalStyles.width;
        pdfSource.style.padding = originalStyles.padding;
    }
}

        // Attach to export button
        document.getElementById('export-pdf').addEventListener('click', exportToPDF);
        
        // Export to Excel (CSV)
        document.getElementById('export-excel').addEventListener('click', function() {
            const trips = getTrips();
            
            // Prepare CSV content
            let csvContent = "Vehicle,Owner,Date,Route,Cargo Type,Weight (Ton),Fare,Advance,Due,Commission,Notes\n";
            
            trips.forEach(trip => {
                csvContent += `"${trip.vehicleNumber}","${trip.ownerName}","${formatDate(trip.date)}","${trip.loadingPoint} → ${trip.unloadingPoint}","${trip.cargoType}",${trip.cargoWeight},${trip.totalFare},${trip.advancePayment},${trip.duePayment},${trip.commission},"${trip.notes || ''}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `Farida_Transport_Trips_${formatDate(new Date(), true).replace(/[, ]/g, '_')}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('CSV exported successfully');
        });
        
        // Apply filter
        document.getElementById('apply-filter').addEventListener('click', function() {
            renderTripHistory();
            showToast('Filter applied successfully');
        });
        
        // Reset filter
        document.getElementById('reset-filter').addEventListener('click', function() {
            document.getElementById('filter-date-from').value = '';
            document.getElementById('filter-date-to').value = '';
            document.getElementById('filter-vehicle').value = '';
            document.getElementById('filter-owner').value = '';
            document.getElementById('filter-status').value = '';
            renderTripHistory();
            showToast('Filters reset');
        });
        
        // Auto-fill owner info when vehicle is selected
        document.getElementById('vehicle-number').addEventListener('change', function() {
            const vehicle = this.value;
            const owner = getOwnerByVehicle(vehicle);
            
            if (owner) {
                document.getElementById('owner-name').value = owner.name;
                document.getElementById('owner-mobile').value = owner.mobile;
                
                // Also set driver info if available
                const ownerVehicle = owner.vehicles.find(v => v.number === vehicle);
                if (ownerVehicle) {
                    document.getElementById('driver-name').value = ownerVehicle.driver || '';
                }
            } else {
                document.getElementById('owner-name').value = '';
                document.getElementById('owner-mobile').value = '';
                document.getElementById('driver-name').value = '';
            }
        });
        
        // Check if user is already logged in
        function checkLoginStatus() {
            const user = JSON.parse(localStorage.getItem(DB_KEYS.USER));
            if (user && user.loggedIn) {
                loginScreen.classList.add('hidden');
                appContainer.classList.remove('hidden');
                initDatabase();
                updateDashboard();
                renderTripHistory();
                renderOwnerProfile();
            }
        }
        
        // Initialize the app
        checkLoginStatus();
    </script>
</body>
</html>